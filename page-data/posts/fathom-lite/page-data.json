{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/fathom-lite","result":{"data":{"markdownRemark":{"id":"ba21665e-9ba2-5775-a401-de5e39a51505","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAUDBv/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAbuKAV3LD//EABkQAAMBAQEAAAAAAAAAAAAAAAACAwEEEv/aAAgBAQABBQI0a011G9zv1OzH/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIAEBEiUf/aAAgBAQAGPwKsZ1Bin0bCi8gV/8QAGhABAQACAwAAAAAAAAAAAAAAAQARMUFhgf/aAAgBAQABPyFcTuhELOns5weRxt9hv//aAAwDAQACAAMAAAAQYw//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAEAAwACAwAAAAAAAAAAAAABABEhMWFxgaH/2gAIAQEAAT8QIVqxHnCJSLnQQjwQdKRzLSjuv49TDAPJc//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6fbf827c09d8437c31570121c5933f99/8ac56/analytics-cover.webp 240w,\n/static/6fbf827c09d8437c31570121c5933f99/d3be9/analytics-cover.webp 480w,\n/static/6fbf827c09d8437c31570121c5933f99/e46b2/analytics-cover.webp 960w,\n/static/6fbf827c09d8437c31570121c5933f99/f992d/analytics-cover.webp 1440w,\n/static/6fbf827c09d8437c31570121c5933f99/882b9/analytics-cover.webp 1920w,\n/static/6fbf827c09d8437c31570121c5933f99/019b0/analytics-cover.webp 3999w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6fbf827c09d8437c31570121c5933f99/09b79/analytics-cover.jpg 240w,\n/static/6fbf827c09d8437c31570121c5933f99/7cc5e/analytics-cover.jpg 480w,\n/static/6fbf827c09d8437c31570121c5933f99/6a068/analytics-cover.jpg 960w,\n/static/6fbf827c09d8437c31570121c5933f99/644c5/analytics-cover.jpg 1440w,\n/static/6fbf827c09d8437c31570121c5933f99/0f98f/analytics-cover.jpg 1920w,\n/static/6fbf827c09d8437c31570121c5933f99/d55cf/analytics-cover.jpg 3999w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6fbf827c09d8437c31570121c5933f99/6a068/analytics-cover.jpg\"\n            alt=\"cover\"\n            title=\"cover\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n<span>Photo by <a href=\"https://unsplash.com/@markuswinkler?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText\">Markus Winkler</a> on <a href=\"https://unsplash.com/s/photos/charts?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText\">Unsplash</a></span></p>\n<p>I have recently been playing around with <a href=\"https://usefathom.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Fathom</a> to gather visitor stats on my websites.  I really like its promise of being a “simple, light-weight privacy-first alternative to Google Analytic”.</p>\n<p>It was also appealing that they offer a <a href=\"https://github.com/usefathom/fathom\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">lite version</a> for those who wish to self host.  Seeing they provided a pre-built Docker image made it a no-brainer to want to give it a spin. It took a bit of configuration to get everything working and I’ve documented the steps here in case it’s helpful for anyone else (AKA me in 6 months).</p>\n<p>So before diving into the details, this is the overall picture of the setup:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/09b3447700dbdbf6e71d698f550be9e6/e17e5/fathom-lite-overview.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAC4jAAAuIwF4pT92AAADnklEQVQozwGTA2z8AAUEAxMRDicjHj43MFZMQ2tgVH1xY4t/b5WId5uNfZyPgJaKe4uBc390aGtjWVZQST47NSYlIRMSEAUFBAAYFhIyLSdQRz9tY1iJfm+hlIO1ppTDtKDNvKfNvajFtqLGuKa+saGmnI2ckoWIf3VtZl1PS0QyLysYFxUANC8qVk5FeG5imIx8s6WTyryp2Mm14tPA6drI6NvK4dbF5dnI4djHy8O1yL+xsamdl5CGeXNqVVFLMzIuAFJKQXhuYpmNfbqrmdbFsNnJs9nJtOnayO/i0PDk0vTn1fXo1uzfzezgz+rg0NfOwbqzpp2WjXhya1FNRwBrYVaUiHmzpZPcy7XfzrjZxq/v2sL35cz148z15Mzx38rz4s7o2MTx49Dx49Lu4M/Wyrq5sKWVjoVqZV8AfnRopZiHxbak5dW/5tXA59fC6djD69vF9+XP9+bS6NrJ59vK6d7P7uPU8OPV8OPU5drMyL+zqqKZfXhyAId+dK2hlMq7rNzOverczNvPv9PGt+TYyebay97Sw+zh1N7WytvUx+ff0+nh1urj2ebf1c7IvrOtpIiEfQCAenKjnJO6s6jEu7Dh2c3Ty8DJwbbj3NDa1s3W0cjj3tTd3NTX18/c29Tk5N3f39nl5N/KycSvrqiKiIQAeHNsmpWMsayivLes1M/G1NLJzsvC1tLJ3tzU5ubd3dzT4ODZ4+Pe6Onl39/c3uDd4+Thx8jEpqaigoJ/AGpnYomGgKGfl7SxqMPBus3MxdHRyc/NxdfXzd3d1d3e1uDh2+Hh39na2NXY1+Dk5Nfa277AwJOUk3N0cgBXVlJ1dXCPj4mqqqO2trDFxr7KysLNzcXNzcXMzMXQ0MnQ0M3Nz83P09HZ3t/T2NrBxcaprK59gIFcXl0AQUE+XFxXd3ZxmpqVpqajr7Cstrexs7OutLSvtLWvtbWxu727wMXDwcXGub2/sLW3mJuce35+Wl5fQEJCACkoJz8+O1VVUW5taYiIhpqamaWnpbS3tL3BvsDDwb7Av7q9vLa6u6+ztaOoqpKXmHuAgV9iZENGRyosLAATExInJyQ7OzlPUE1oaWd+fn6OkI6Zm5qgo6KhpKOgo6OdoKCXm5yMkpN+hIVsb3BWWlw/QkQnKikTFRQABAQEDg4OHR0cLy8tQEBAUFFPXV5caGlpcXNzcnR0cnRzbnFyaGtsXmBiUVRWQURFLzEyHiAgDhAQBAQEEXknYgtSyCsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/09b3447700dbdbf6e71d698f550be9e6/8ac56/fathom-lite-overview.webp 240w,\n/static/09b3447700dbdbf6e71d698f550be9e6/7f61c/fathom-lite-overview.webp 400w\"\n              sizes=\"(max-width: 400px) 100vw, 400px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/09b3447700dbdbf6e71d698f550be9e6/8ff5a/fathom-lite-overview.png 240w,\n/static/09b3447700dbdbf6e71d698f550be9e6/e17e5/fathom-lite-overview.png 400w\"\n            sizes=\"(max-width: 400px) 100vw, 400px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/09b3447700dbdbf6e71d698f550be9e6/e17e5/fathom-lite-overview.png\"\n            alt=\"diagram\"\n            title=\"diagram\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li>The Fathom server is running on port 7070.    </li>\n<li>The nginx server is running on port 8080.</li>\n<li>\n<p>The container’s port 8080 is bound to the host’s port 9090.</p>\n<hr />\n</li>\n</ul>\n<p>On my host machine as root:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mkdir /opt/fathom</code></pre></div>\n<p>Create a <code class=\"language-text\">fathom.conf</code> file in <code class=\"language-text\">/opt/fathom</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">server {\n\tserver_name your.domain.name;\n\n\tlocation / {\n\t\tproxy_set_header X-Real-IP $remote_addr;\n\t\tproxy_set_header X-Forwarded-For $remote_addr;\n\t\tproxy_set_header Host $host;\n\t\tproxy_pass http://127.0.0.1:7070; \n\t}  \n}</code></pre></div>\n<p>We will be mapping above <code class=\"language-text\">fathom.conf</code> file to a directory in the container to be used by nginx.</p>\n<p>Create an <code class=\"language-text\">.env</code> file (also in /opt/fathom):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FATHOM_SERVER_ADDR=\":7070\"\nFATHOM_DATABASE_NAME=\"/app/config/fathom.db\"</code></pre></div>\n<p>This <code class=\"language-text\">.env</code> file will start the fathom server on port 7070 and place the sqlite db file in <code class=\"language-text\">/app/config</code> in the Docker container.</p>\n<p>Ok, let’s start our Docker container:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo docker run -d -v /opt/fathom:/app/config -p 9090:8080 -p 80:80 --name fathom usefathom/fathom:latest ./fathom --config /app/config/.env server</code></pre></div>\n<p>Woah!! Woah!! Woah!! I know what you’re thinking.  What the heck is going on here??!!!</p>\n<p>Let’s break down in this docker command:    </p>\n<p><code class=\"language-text\">sudo docker run -d</code> - This runs the Docker container.    </p>\n<p><code class=\"language-text\">-v /opt/fathom:/app/config</code> - This maps a volume from our host machine (<code class=\"language-text\">/opt/fathom</code>) to a directory in our Docker container (<code class=\"language-text\">/app/config</code>).    </p>\n<p><code class=\"language-text\">-p 9090:8080 -p 80:80</code> - This exposes the container’s port 8080 as the host’s port 9090.  The second argument exposes port 80 as itself.  This will be needed for generating a Let’s Encrypt SSL certificate.    </p>\n<p><code class=\"language-text\">--name fathom</code> - This names the container so we can easily reference it.    </p>\n<p><code class=\"language-text\">usefathom/fathom:latest</code> - This pulls down the pre-built Docker container provided by Fathom.    </p>\n<p><code class=\"language-text\">./fathom --config /app/config/.env server</code> - This starts the fathom server using the <code class=\"language-text\">.env</code> file we just created and mapped into the container.    </p>\n<p>Now that we have created a running Docker container, we can access it with an interactive bash shell with the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo docker exec -it fathom /bin/bash</code></pre></div>\n<p>NOTE: I didn’t give docker the permissions needed to run it without <code class=\"language-text\">sudo</code>.</p>\n<p>Once in the container, you should be in the <code class=\"language-text\">/app</code> directory.    </p>\n<p>Let’s create a fathom user:    </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">fathom --config /app/config/.env user add --email=\"your@email.com\" --password=\"strong-password\"</code></pre></div>\n<p>Install nginx, certbot and the certbot/nginx plugin:    </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apk add certbot certbot-nginx nginx</code></pre></div>\n<p>NOTE: The pre-built Docker container is based on the <a href=\"https://alpinelinux.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Alpine Linux</a> distribution. Coincidentally, the host machine I’m using is a <a href=\"https://www.linode.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Linode</a> that is also Alpine Linux.</p>\n<p>Symlink the previously created <code class=\"language-text\">fathom.conf</code> so nginx can use it:    </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ln -s /app/config/fathom.conf /etc/nginx/conf.d/fathom.conf    </code></pre></div>\n<p>Create certs from Let’s Encrypt:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mkdir /run/nginx\ncertbot --nginx -d your-site.com</code></pre></div>\n<p>There will be a series of questions you will need to answer and once done there be updates to your conf file.</p>\n<p>Open up <code class=\"language-text\">/etc/nginx/conf.d/fathom.conf</code> and find the updated section.  It should looks something like this (excerpt):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">    listen 80; # managed by Certbot\n\n    listen 443 ssl; # managed by Certbot\n    ssl_certificate /etc/letsencrypt/live/yoursite.com/fullchain.pem; # managed by Certbot\n    ssl_certificate_key /etc/letsencrypt/live/yoursite.com/privkey.pem; # managed by Certbot\n    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot</code></pre></div>\n<p>Replace <code class=\"language-text\">443</code> to <code class=\"language-text\">8080</code>, the final content should look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">server {\n\tserver_name your.domain.name;\n\n\tlocation / {\n\t\tproxy_set_header X-Real-IP $remote_addr;\n\t\tproxy_set_header X-Forwarded-For $remote_addr;\n\t\tproxy_set_header Host $host;\n\t\tproxy_pass http://127.0.0.1:7070; \n\t}  \n\n    listen 80; # managed by Certbot\n\n    listen 8080 ssl; # managed by Certbot\n    ssl_certificate /etc/letsencrypt/live/yoursite.com/fullchain.pem; # managed by Certbot\n    ssl_certificate_key /etc/letsencrypt/live/yoursite.com/privkey.pem; # managed by Certbot\n    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n}</code></pre></div>\n<p>Run nginx:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">nginx -t\nnginx</code></pre></div>\n<p>Whew! That was a lot! Now go to <code class=\"language-text\">https://yourdomain.com:9090</code> to see your freshly installed Fathom Lite dashboard!</p>","fields":{"slug":"/posts/fathom-lite","tagSlugs":null},"frontmatter":{"date":"2020-12-19","description":"Setting up an alternative to Google Analytics.","tags":null,"title":"Setting up Fathom Lite in a Docker Container","socialImage":null}}},"pageContext":{"slug":"/posts/fathom-lite"}},"staticQueryHashes":["251939775","401334301","914177244"]}